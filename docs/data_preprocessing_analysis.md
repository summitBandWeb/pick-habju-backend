# 데이터 전처리 파이프라인 분석 리포트

**작성일**: 2026-02-06

## 프로젝트 개요

픽-합주(pick-habju)는 합주실 예약 서비스로, 네이버 지도를 통해 합주실 데이터를 크롤링하여 제공합니다. 수집된 데이터는 비정형 텍스트 형태의 룸 설명(room description)으로 제공되며, 이를 정형 데이터로 변환하기 위해 `room_parser_service.py` 모듈을 사용합니다.

**파싱 파이프라인 구조**:
```
Keyword Map → Regex → LLM (Ollama) → Regex Fallback
```

이 리포트는 실제 수집된 데이터를 기반으로 파싱 파이프라인의 성능을 분석하고, 개선 방향을 제시합니다.

## 분석 방법론

### 데이터 수집
- **검색 쿼리**: "홍대 합주실" (네이버 지도)
- **크롤링 시도**: 30개 업체
- **수집 실패**: 8개 (폐업 또는 정보 없음)
- **성공적 수집**: 22개 업체, 113개 룸

### 데이터 특성
- **설명(description) 존재**: 113개 (100%)
- **가격(price) 정보**: 101개 (89.4%)
- **태그(name tag)**: 39개 (34.5%) - 예: [평일], [주말], [심야]

### 테스트 방법
- 113개 룸 전체를 Regex 전용 파서로 실행 (LLM 단계 모킹)
- 수용 인원(max_capacity) 추출 성공률 측정
- False Positive 검증 및 버그 수정

## 주요 발견 사항

### 1. 파싱 성공률: 30/113 (26.5%)

> **핵심 인사이트**: 전체 룸 중 26.5%만이 수용 인원 정보를 성공적으로 파싱했습니다.

- **성공**: 30개 룸에서 max_capacity 추출 완료
- **실패**: 83개 룸 (73.5%)은 설명 텍스트에 수용 인원 정보 자체가 없음

### 2. 실제 데이터 범위

| 항목 | 범위 | 비고 |
|------|------|------|
| **수용 인원** | 2~15명 | 합주실 특성상 현실적인 범위 |
| **가격** | 6,000~25,000원 | 1개 아웃라이어 제외 (레코딩 전화문의 1원 플레이스홀더) |
| **현재 검증 범위** | 인원: 1~50, 가격: 0~50,000 | 충분한 범위, 조정 불필요 |

### 3. False Positive 버그 발견 및 수정

**문제 상황**:
- "Orange OB1-500 Head" (베이스 앰프 모델명)가 max_capacity=500으로 파싱되는 버그 발견

**근본 원인**:
```python
# 기존 패턴 6 (문제)
r'(\d+)\s*[~\-]\s*(\d+)\s*(?:인|명)?'  # 인/명 접미사 선택적

# "OB1-500"이 "1~500"으로 매칭됨
```

**해결 방법**:
```python
# 수정된 패턴 6
r'(\d+)\s*[~\-]\s*(\d+)\s*(?:인|명)'  # 인/명 접미사 필수화
```

**결과**:
- False Positive 8개 제거 (파싱 성공 38개 → 30개)
- 정밀도(Precision) 향상

### 4. 업체별 파싱 성공률 분석

| 업체명 | 성공/전체 | 설명 타입 |
|--------|-----------|-----------|
| 제시뮤직 홍대 합주실 | 7/8 | 명시적 인원 정보 ("10인이 합주 가능", "4인 까지 이용 가능") |
| 오렌지합주실 | 6/6 | 모든 룸에 인원 정보 포함 |
| 호랑이 합주실 | 3/3 | 모든 룸에 인원 정보 포함 |
| 제시뮤직합주실 합정점 | 3/3 | 모든 룸에 인원 정보 포함 |
| 라라합주실 | 3/3 | 모든 룸에 인원 정보 포함 |
| 헤일 뮤직 스튜디오 | 2/2 | 모든 룸에 인원 정보 포함 |
| 신촌 그라운드 합주실 | 2/2 | 모든 룸에 인원 정보 포함 |
| 사운드시티 합주실 합정 본점 | 1/6 | 장비 목록 위주, 1개 룸만 인원 정보 포함 |
| 에비로드 합주실 | 1/3 | 혼재 |
| 이막합주실 | 1/4 | 혼재 |
| 디엠 합주실 디엠스튜디오 | 1/2 | 혼재 |
| 그라운드합주실 본점 | 0/11 | 장비 목록만 |
| 브라운합주실 | 0/12 | 장비 목록만 (버그 수정 전 6/12) |
| 그라운드 합주실 홍대1호점 | 0/9 | 장비 목록만 (버그 수정 전 1/9) |
| 홍대음악당 | 0/7 | 장비 목록만 |
| 그라운드 합주실 합정1호점 | 0/6 | 장비 목록만 |
| 사운드시티 합주실 홍대역점 | 0/5 | 장비 목록만 |
| 웨이브랩 합주실 & 레코딩 | 0/5 | 장비 목록만 |
| 라디오가가합주실 신촌점 | 0/5 | 장비 목록만 |
| 잼 합주실 | 0/4 | 장비 목록만 |
| 하모닉스 합주실 2호점 | 0/4 | 장비 목록만 |
| 하모닉스 합주실 | 0/3 | 장비 목록만 |

### 5. 핵심 문제: 데이터 부재

> **중요**: 73.5%의 파싱 실패는 파서 로직의 문제가 아닙니다. 해당 룸들의 설명에 수용 인원 정보가 아예 포함되어 있지 않습니다.

**장비 목록만 포함된 전형적인 예시**:
```
Drums
-Tama Starclassic

Guitar Amp
-Marshall JCM2000 TSL100 & 1960A
-Marshall JCM2000 DSL100 & 1960A

Bass Amp
-Ampeg SVT Classic & Heritage SVT 810E

Keyboard
-Yamaha Montage8
-Yamaha Montage7
```

위와 같이 순수 장비 목록만 제공하는 경우, 정규식이나 LLM 어떤 방법으로도 수용 인원을 추출할 수 없습니다.

### 6. 파이프라인 상세 흐름 및 순서 검토

**현재 순서**: Keyword Map → Regex → LLM → Regex Fallback

각 단계에서 실패 시 **원본 name/desc가 그대로** 다음 단계로 전달됩니다.

```text
Level 1: Keyword Map
  → name에서 "대형/중형/소형" 키워드 검사
  → 매칭 안 되면 원본 name/desc 그대로 통과

Level 2: Regex
  → _parse_with_regex(name, desc) 호출
  → max_capacity 추출 성공 시 즉시 return
  → 실패 시 결과 버리고 원본 name/desc로 다음 단계

Level 3: LLM (Ollama)
  → _clean_text_for_llm()으로 노이즈 제거된 텍스트를 LLM에 전달
  → LLM 응답 실패 / JSON 파싱 실패 / 검증 실패 시 다음 단계

Level 4: Fallback Regex
  → 다시 _parse_with_regex(name, desc)를 원본으로 호출
  → clean_name, day_type 등 부분 정보라도 반환하는 안전망
```

> **주의**: Level 4(Fallback Regex)는 Level 2와 동일한 원본 입력으로 동일한 함수를 호출합니다. Level 2에서 실패한 케이스가 Level 4에서 성공할 수는 없습니다. Fallback의 역할은 LLM 실패 시 "빈 결과보다 낫다"는 취지로 부분 정보(clean_name, day_type 등)라도 반환하는 것입니다.

**순서 검토 결론**:
- **명시적 정보가 있는 26.5%**: Regex만으로 충분히 처리 가능, LLM 불필요
- **정보가 없는 73.5%**: Regex와 LLM 모두 무력 - 데이터 자체 부재
- **순서가 중요한 엣지 케이스**: 극소수 (예: 복잡한 가격 체계 내 인원 정보 임베딩)

> **결론**: 현재의 Regex-first 접근 방식이 속도와 비용 측면에서 최적입니다.

### 7. 검증 범위 적정성

| 항목 | 현재 범위 | 실제 데이터 | 평가 |
|------|-----------|-------------|------|
| max_capacity | 1~50명 | 2~15명 | 적정 |
| price | 0~50,000원 | 6,000~25,000원 | 적정 |

현재 설정된 검증 범위는 실제 데이터를 충분히 포괄하며, 조정이 필요하지 않습니다.

## 다음 단계: 73.5% 데이터 갭 해소 방안

73.5%의 파싱 실패 룸에 대한 수용 인원 정보를 확보하기 위해 다음 접근 방식들을 고려할 수 있습니다.

### 1. 룸 이름 패턴 추론
- 많은 업체에서 S/A/B/C 등 알파벳 순서로 룸 이름을 지정
- 일반적으로 알파벳 순서와 룸 크기가 상관관계를 가짐
- 동일 업체 내에서 상대적 크기 추론 가능

**예시**:
```
Room A (6,000원) → 추정 2~3명
Room B (10,000원) → 추정 4~5명
Room C (15,000원) → 추정 6~8명
```

### 2. 가격 기반 추론
- 동일 업체 내에서 가격과 룸 크기는 비례 관계
- 같은 업체의 다른 룸에서 가격-인원 관계를 학습
- 선형 보간법 또는 머신러닝 모델 활용

**장점**: 데이터 기반 추론
**단점**: 업체별 가격 정책 차이, 특수 장비에 따른 가격 변동 고려 필요

### 3. 수동 리뷰 및 보완
- 현재 구현된 `_export_unresolved()` 메서드 활용
- 파싱 실패 케이스를 별도 파일로 내보내기
- 담당자가 수동으로 검토 후 데이터베이스에 직접 입력

**장점**: 가장 정확한 방법
**단점**: 시간 소요, 확장성 제한

### 4. 외부 데이터 소스 활용
- 업체 공식 웹사이트 크롤링
- 전화 문의를 통한 직접 확인
- 사용자 리뷰/후기 데이터 분석

**장점**: 정확한 1차 정보 획득
**단점**: 추가 개발 비용, 유지보수 복잡도 증가

### 5. 하이브리드 접근
위 방법들을 조합하여 사용:
1. 자동 파싱으로 26.5% 처리
2. 가격/이름 기반 추론으로 추가 30~40% 처리
3. 나머지는 수동 리뷰 또는 외부 소스 활용

## 결론

현재 데이터 전처리 파이프라인은 명시적인 수용 인원 정보가 있는 경우(26.5%) 효과적으로 작동합니다. False Positive 버그 수정을 통해 정밀도도 개선되었습니다.

그러나 73.5%의 룸은 설명 텍스트에 수용 인원 정보가 없어 파싱이 불가능한 상황입니다. 이는 파서 로직의 문제가 아니라 원천 데이터의 한계입니다.

> **권장 사항**: 단기적으로는 현재 파이프라인을 유지하고, 파싱 실패 케이스에 대해서는 가격/이름 기반 추론 또는 수동 리뷰를 통해 점진적으로 데이터 품질을 개선하는 것이 현실적입니다.

장기적으로는 업체들과 협력하여 구조화된 데이터 제공을 유도하거나, 자체 데이터베이스를 구축하는 방향을 고려해야 합니다.

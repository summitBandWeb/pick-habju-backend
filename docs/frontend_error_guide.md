# ğŸš§ í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œíŒ€ì„ ìœ„í•œ ì—ëŸ¬ í•¸ë“¤ë§ ê°€ì´ë“œ

ì•ˆë…•í•˜ì„¸ìš”! ë°±ì—”ë“œ íŒ€ì…ë‹ˆë‹¤. ğŸ™‡â€â™‚ï¸
ì´ë²ˆì— **API ì‘ë‹µ ë° ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ëŒ€ëŒ€ì ìœ¼ë¡œ ê°œí¸**í•˜ê²Œ ë˜ì–´, ë³€ê²½ ë°°ê²½ê³¼ í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ê°€ì´ë“œë¥¼ ê³µìœ ë“œë¦½ë‹ˆë‹¤.

---

## 1. ë³€ê²½ ë°°ê²½ (Why Changed?)

ê¸°ì¡´ì—ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ ì‘ë‹µ í¬ë§·ì´ ì¼ê´€ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
ì–´ë–¤ APIëŠ” `detail` ë©”ì‹œì§€ë¥¼ ì£¼ê³ , ì–´ë–¤ APIëŠ” `error` í•„ë“œë¥¼ ì£¼ëŠ” ë“± í˜¼ë€ì´ ìˆì—ˆì£ .

### ğŸš« Before (ê¸°ì¡´ ë¬¸ì œì )
```javascript
// í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ì´ë ‡ê²Œ ë³µì¡í•˜ê²Œ ì²˜ë¦¬í•´ì•¼ í–ˆìŠµë‹ˆë‹¤ ğŸ˜«
try {
  await api.post('/room');
} catch (err) {
  if (err.response.data.detail) {
    alert(err.response.data.detail); // Case 1
  } else if (err.response.data.message) {
    alert(err.response.data.message); // Case 2
  } else {
    alert("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜");
  }
}
```

### âœ… After (ê¸°ëŒ€ íš¨ê³¼)
ì´ì œ **"ëª¨ë“  ì—ëŸ¬"**ëŠ” ë‹¨ í•˜ë‚˜ì˜ í†µì¼ëœ ê·œê²©(`ApiResponse`)ìœ¼ë¡œ ë‚´ë ¤ê°‘ë‹ˆë‹¤.
ì„±ê³µì´ë“  ì‹¤íŒ¨ë“  í•­ìƒ ê°™ì€ ë´‰íˆ¬(Envelope)ì— ë‹´ê²¨ ì˜µë‹ˆë‹¤.

---

## 2. ë³€ê²½ëœ ì‘ë‹µ ê·œê²© (Spec)

ëª¨ë“  API ì‘ë‹µ(ì„±ê³µ/ì‹¤íŒ¨ í¬í•¨)ì€ ì•„ë˜ JSON í˜•íƒœë¥¼ ë³´ì¥í•©ë‹ˆë‹¤.

```json
{
  "isSuccess": false,          // ì„±ê³µ ì—¬ë¶€ (true/false)
  "code": "COMMON-001",          // ì—ëŸ¬ ì½”ë“œ (ìƒìˆ˜)
  "message": "ì´ë¯¸ ì˜ˆì•½ëœ ì‹œê°„ì…ë‹ˆë‹¤.", // ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ì¹œì ˆí•œ ë©”ì‹œì§€
  "result": null               // (ì„±ê³µ ì‹œ ë°ì´í„°, ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ìƒì„¸)
}
```

---

## 3. í”„ë¡ íŠ¸ì—”ë“œ ì‘ì—… ê°€ì´ë“œ (To-Do)

**"ì‘ì—…í•˜ì‹œëŠë¼ í”¼ê³¤í•˜ì‹œê² ì§€ë§Œ, ë”± í•œ ë²ˆë§Œ ìˆ˜ì •í•´ë‘ë©´ ì•ìœ¼ë¡œ ì—„ì²­ í¸í•´ì§€ì‹¤ ê±°ì˜ˆìš”!"**

ê°œë³„ ì»´í¬ë„ŒíŠ¸ë‚˜ í˜ì´ì§€ì˜ `try-catch` êµ¬ë¬¸ì„ ì¼ì¼ì´ ìˆ˜ì •í•˜ì‹¤ í•„ìš” **ì—†ìŠµë‹ˆë‹¤**.
ì‚¬ìš© ì¤‘ì´ì‹  HTTP Client (Axios, Fetch ë“±)ì˜ **Response Interceptor (ì „ì—­ ì²˜ë¦¬)** ë¶€ë¶„ë§Œ ìˆ˜ì •í•´ì£¼ì„¸ìš”.

### ì˜ˆì‹œ (Axios Interceptor)

```javascript
// axiosInstance.js (ë˜ëŠ” api ì„¤ì • íŒŒì¼)

instance.interceptors.response.use(
  (response) => {
    // ì„±ê³µ ì‘ë‹µ (isSuccess: true)
    return response;
  },
  (error) => {
    // 1. ì„œë²„ì—ì„œ ë‚´ë ¤ì¤€ í‘œì¤€ í¬ë§·ì´ ìˆëŠ”ì§€ í™•ì¸
    if (error.response && error.response.data) {
      const { isSuccess, message, code, result } = error.response.data;

      // 2. í‘œì¤€ í¬ë§·ì´ë¼ë©´, ê·¸ëŒ€ë¡œ ë©”ì‹œì§€ë¥¼ ì‚¬ìš© (ë‹¨, ì¸ì¦ ì—ëŸ¬ ë“±ì€ ë³„ë„ ì²˜ë¦¬)
      if (isSuccess === false) {
        console.error(`[Error] ${code}: ${message}`);
        
        // (ì„ íƒ) ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
        // toast.error(message); 
        
        // (ì¤‘ìš”) í•„ìš”í•˜ë‹¤ë©´ ì—¬ê¸°ì„œ ì—ëŸ¬ë¥¼ throwí•˜ì—¬ ê°œë³„ ì»´í¬ë„ŒíŠ¸ê°€ ì¶”ê°€ ì²˜ë¦¬ë¥¼ í•˜ê²Œ í•¨
        // return Promise.reject(new Error(message));
      }
    }

    // 3. ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ë“± ì˜ˆìƒì¹˜ ëª»í•œ ì¼€ì´ìŠ¤
    return Promise.reject(error);
  }
);
```

### ì˜ˆì‹œ (Fetch API)

`fetch`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ HTTP ì—ëŸ¬ë¥¼ `throw`í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë˜í¼ ìœ í‹¸ë¦¬í‹°ë¥¼ ë§Œë“œëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

```javascript
// user-friendly-fetch.js
export async function myFetch(url, options = {}) {
  try {
    const response = await fetch(url, options);
    const data = await response.json();

    // 1. ì„œë²„ í‘œì¤€ ì—ëŸ¬ ì‘ë‹µ ì²˜ë¦¬
    if (data.isSuccess === false) {
       console.error(`[Error] ${data.code}: ${data.message}`);
       // throw new Error(data.message); // í•„ìš” ì‹œ throw
       return data; // ë˜ëŠ” ì—ëŸ¬ ì •ë³´ê°€ ë‹´ê¸´ data ë°˜í™˜
    }

    return data;
  } catch (err) {
    // ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬ ë“±
    console.error("Network Error:", err);
    throw err;
  }
}
```

### âœ¨ ì¥ì 
1.  **ì˜ˆì™¸ ì²˜ë¦¬ ì½”ë“œ ì‚­ì œ**: ì»´í¬ë„ŒíŠ¸ë§ˆë‹¤ `if (err.detail) ...` í•˜ë˜ ì½”ë“œë¥¼ ì‹¹ ì§€ìš°ì…”ë„ ë©ë‹ˆë‹¤.
2.  **ìë™ ë©”ì‹œì§€**: ë°±ì—”ë“œì—ì„œ ë‚´ë ¤ì£¼ëŠ” `message` í•„ë“œëŠ” ê¸°íšíŒ€ê³¼ í•©ì˜ëœ "ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€"ì…ë‹ˆë‹¤. ê·¸ëŒ€ë¡œ `alert`ë‚˜ `toast`ì— ë„ìš°ì‹œë©´ ë©ë‹ˆë‹¤.
3.  **Validation ì²˜ë¦¬**: ì…ë ¥ê°’ ê²€ì¦ ì‹¤íŒ¨ ì‹œ `result` í•„ë“œì— `{"fieldName": "error msg"}` í˜•íƒœë¡œ ìƒì„¸íˆ ë‚´ë ¤ë“œë¦¬ë‹ˆ, í¼ ì—ëŸ¬ í‘œì‹œì— í™œìš©í•˜ì„¸ìš”.

---

ì´ë²ˆ ë³€ê²½ìœ¼ë¡œ ì ì‹œ ë²ˆê±°ë¡œìš°ì‹œê² ì§€ë§Œ, ì•ìœ¼ë¡œì˜ ê°œë°œ ì†ë„ì™€ ì•ˆì •ì„±ì„ ìœ„í•œ **'ì§€ë°˜ ë‹¤ì§€ê¸°'** ì‘ì—…ì´ë‹ˆ ë„ˆë¥¸ ì–‘í•´ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ğŸ™
ë¬¸ì˜ì‚¬í•­ì€ ì–¸ì œë“  í¸í•˜ê²Œ ë§ì”€í•´ì£¼ì„¸ìš”!
